---
title: "MSA8190 - HW8"
author: "Kristen Biskobing"
date: "November 10, 2016"
output: html_document
---

```{r setup, include=FALSE}
rm(list=ls())
setwd("H:/Desktop/School/MSA8190/homeworks")
#library("pwr")
#library("zoo")
#install.packages("psych")
```

Problem 1

Let x be the compressive strength and y be the intrinsic permeability of various concrete mixes and cures. Summary quantities are n = 15, $\sum_{i=1}^n y_i$ = 572, $\sum_{i=1}^n y_i^2$ = 23530, $\sum_{i=1}^n x_i$ = 43, $\sum_{i=1}^n x_i^2$ = 157.42, and $\sum_{i=1}^n x_i*y_1$ = 1697.80. Assume that the two variables are related according to the simple linear regression model.
```{r}
n<-15
yi<-572
y_bar<-yi/n
yi2<-23530
xi<-43
x_bar<-xi/n
xi2<-157.42
xy<-1697.80
```
(a) Calculate the least squares estimates of the slope and intercept.
```{r}
SSxy<-xy-((yi*xi)/n)
SSxx<-xi2-(xi^2/n)
B_hat1<- SSxy/SSxx
B_hat0<- y_bar-(B_hat1*x_bar)
```
The slope is `r B_hat1` and the intercept is `r B_hat0`

(b) Use the equation of the fitted line to predict what permeability would be observed when the compressive strength is x = 4.3.
```{r}
B_hat0 + (B_hat1*4.3)
```

(c) Give a point estimate of the mean permeability when compressive strength is x = 3.7.
```{r}
ey<-B_hat0 + (B_hat1*3.7)
ey
```

(d) Suppose that the observed value of permeability at x = 3.7 is y = 46.1. Calculate the value of the corresponding residual.
```{r}
46.1-ey
```

(e) Test for significance of regression using $\alpha$ = 0.05. Find the P-value for this test. Can you conclude that the model specifies a useful linear relationship between these two variables?
```{r}
sst<-yi2-n*(y_bar^2)
sse<-sst-(B_hat1*SSxy)
mse<-sse/n-2 #sigma_hat^2  or n???
seb1<-sqrt(mse/SSxx)
alpha<-0.05
T0<-B_hat1/seb1
p<-pt(T0,n-2,lower.tail=FALSE)
p>alpha
```
No, since p>alpha we can not reject the null hypothesis that B1=0, so there may not be a linear relationship between x and y.

(f) Estimate $\sigma^2$ and the standard deviation of $\beat_1hat$.

$\sigma^2$ is `r mse` and the standard deviation of $\beat_1hat$ is `r seb1`

(g) What is the standard error of the intercept in this model?
```{r}
seb0<-sqrt(mse*((1/n)+((xi/n)^2/SSxx)))
seb0
```


Problem 2

Using data in Problem 1, find 95% confidence interval on each of the following.

(a) Slope
```{r}
alpha = 0.05
t_a<-qt(alpha/2,n-2, lower.tail=FALSE)
cil<-B_hat1-t_a*sqrt(mse/SSxx)
ciu<-B_hat1+t_a*sqrt(mse/SSxx)
```
The confidence interval for this is [`r cil`, `r ciu`]

(b) Intercept
```{r}
t_a<-qt(alpha/2,n-2, lower.tail=FALSE)
cil<-B_hat0-t_a*sqrt(mse*((1/n)+((xi/n)^2/SSxx)))
ciu<-B_hat0+t_a*sqrt(mse*((1/n)+((xi/n)^2/SSxx)))
```
The confidence interval for this is [`r cil`, `r ciu`]

(c) Mean permeability when x = 2.5
```{r}
y0<-B_hat0 + (B_hat1*2.5)
cil<-y0-t_a*sqrt(mse*((1/n)+((2.5-(xi/n))^2/SSxx)))
ciu<-y0+t_a*sqrt(mse*((1/n)+((2.5-(xi/n))^2/SSxx)))
```
The confidence interval for this is [`r cil`, `r ciu`]

(d) Find a 95% prediction interval on permeability when x = 2.5. Explain why this interval is wider than the interval in part (c).
```{r}
cil<-y0-t_a*sqrt(mse*(1+(1/n)+((2.5-(xi/n))^2/SSxx)))
ciu<-y0+t_a*sqrt(mse*(1+(1/n)+((2.5-(xi/n))^2/SSxx)))
```
The confidence interval for this is [`r cil`, `r ciu`]. It is larger than the mean confidence interval because it is measuring a single value where the mean is averaging the number over many instances. As n gets higher the means variance decreases and its interval will also decrease, while the prediction of a future value will always have some expected variation. 

Problem 3

Data concerning the performance of the 28 National Football League teams in 1976 are shown below. Excel file can be found in D2L. It is suspected that the number of games won (y) is related to the number of yards gained rushing by an opponent (x).
```{r}
y<-c(10,11,11,13,10,11,10,11,4,2,7,10,9,9,6,5,5,5,6,4,3,3,4,10,6,8,2,0)
x<-c(2205,2096,1847,1903,1457,1848,1564,1821,2577,2476,1984,1917,1761,1709,1901,2288,2072,2861,2411,2289,2203,2592,2053,1979,2048,1786,2876,2560)
n<-28
```

(a) Calculate the least squares estimates of the slope and intercept. What is the estimate of $\sigma^2$? Graph the regression model.
```{r}
lse<-lm(y~x)
B0<-lse$coef[[1]]
B1<-lse$coef[[2]]
sig2<-summary(lse)$sigma^2
```
The lse intercept is `r B0`, the slope is `r B1`, and $\sigma^2$ is estimated to be `r sig2`.


```{r}
plot(x,y)
abline(lse)
```

(b) Find an estimate of the mean number of games won if the opponents can be limited to 1800 yards rushing.
```{r}
B0+(B1*1800)
```

(c) What change in the expected number of games won is associated with a decrease of 100 yards rushing by an opponent?
```{r}
z<-(B1*-100)
```
Subtracting 100 yards, results in an increase of `r z` games won.

(d) To increase by 1 the mean number of games won, how much decrease in rushing yards must be generated by the defense?
```{r}
z<-1/B1
```
The team needs to decrease rushing by `r z` yards to increase by 1 game. 

(e) Given that x = 1917 yards (Cincinnati), find the fitted value of y and the corresponding residual.
```{r}
y_hat<-B0+(B1*1917)
y_i<-y[12]
res<-y_i-y_hat
```
The expected number of wins for Cincinnati is `r y_hat`. The actual wins is `r y_i`, giving a residual of `r res`.

(f) Test for significance of regression using $\alpha$ = 0.01. Find the P-value for this test. What conclusions can you draw?
```{r}
alpha<-0.01
anova(lse)
fa<-qf(alpha,1,n-2, lower.tail=FALSE)
fa
2*pf(31.103,1,n-2, lower.tail=FALSE)
```
The F value is much higher than the Fa value and the p value is much lower than alpha, so can reject the null hypothesis that the slope is 0. Therefore we can say that there is a relationship between rushing yards and games won. 

(g) Estimate the standard errors of the slope and intercept.
```{r}
summary(lse)
```
The standard error for the slope is 0.001260 and the intercept is 2.696233

(h) Test (using $\alpha$ = 0.01) H0 $\beat_1$ = -0.01 versus H1 $\beat_1$ <>-0.01. Would you agree with the statement that this is a test of the claim that if you can decrease the opponent's rushing yardage by 100 yards the team will win one more game?
```{r}
alpha<-0.01
sxx<-sum(x^2)-(sum(x)^2/n)
T0<-(B1+0.01)/sqrt(sig2/sxx)
p<-pt(T0,n-2,lower.tail=FALSE)
p
```
Yes, this is testing whether the slope is -0.01, which translates to 100 yards per each game. Since p>alpha, we fail to reject the null hypothesis $\beat_1$ = -0.01. 

Problem 4

Using data in Problem 3, find 95% confidence interval on each of the following.

(a) Slope
```{r}
alpha = 0.05
t_a<-qt(alpha/2,n-2,lower.tail=FALSE)
cil<-B1-t_a*sqrt(sig2/sxx)
ciu<-B1+t_a*sqrt(sig2/sxx)
```
The confidence interval for this is [`r cil`, `r ciu`]

(b) Intercept
```{r}
cil<-B0-t_a*sqrt(sig2*((1/n)+((sum(x)/n)^2/sxx)))
ciu<-B0+t_a*sqrt(sig2*((1/n)+((sum(x)/n)^2/sxx)))
```
The confidence interval for this is [`r cil`, `r ciu`]

(c) Mean number of games won when opponents rushing yardage is limited to x = 1800.
```{r}
y0<-B0 + (B1*1800)
cil<-y0-t_a*sqrt(sig2*((1/n)+((1800-(sum(x)/n))^2/sxx)))
ciu<-y0+t_a*sqrt(sig2*((1/n)+((1800-(sum(x)/n))^2/sxx)))
```
The confidence interval for this is [`r cil`, `r ciu`]

(d) Find a 95% prediction interval on the number of games won when opponents rushing yards is 1800.
```{r}
cil<-y0-t_a*sqrt(sig2*(1+(1/n)+((1800-(sum(x)/n))^2/sxx)))
ciu<-y0+t_a*sqrt(sig2*(1+(1/n)+((1800-(sum(x)/n))^2/sxx)))
```
The confidence interval for this is [`r cil`, `r ciu`]


Problem 5

For data in Problem 3.

(a) Calculate R^2 for this model and provide a practical interpretation of this quantity.
```{r}
summary(lse)
```
R^2=0.5447, which means this rushing yards model can explain around 54% of the outcome of a game.  

(b) Prepare a normal probability plot of the residuals from the least squares model. Does the normality assumption seem to be satisfied?
```{r}
resid<-lse$residuals
par(mfrow = c(1, 2))
plot(resid)
qqnorm(resid);qqline(resid)
shapiro.test(resid)
```
For the most part, the graphs seems to follow what a normal distribution should look like. Using the shapiro test confirms this assumption. 

(c) Plot the residuals versus y and against x. Interpret these graphs.
```{r}
par(mfrow = c(1, 2))
plot(resid, y)
plot(resid, x)
```

The y vs residual plot seems to almost have a positive corrolation. Since the model only accounts for around half of the error this would make sense. The plot against the x variable seems to be random, which confirms the conclusion that it does have some impact on the y value. 


Problem 9

The 1976 team performance statistics for the teams in the National Football League is given in the Excel file.
```{r}
y<-c(10,11,11,13,10,11,10,11,4,2,7,10,9,9,6,5,5,5,6,4,3,3,4,10,6,8,2,0)
x2<-c(1985,2855,1737,2905,1666,2927,2341,2737,1414,1838,1480,2191,2229,2204,2140,1730,2072,2929,2268,1983,1792,1606,1492,2835,2416,1638,2649,1503)
x7<-c(59.7,55,65.6,61.4,66.1,61,66.1,58.9,57,58.9,68.5,59.2,58.8,58.6,59.2,54.4,49.6,54.3,58.7,51.7,61.9,52.7,57.8,59.7,54.9,65.3,43.8,53.5)
x8<-c(2205,2096,1847,1903,1457,1848,1564,1821,2577,2476,1984,1917,1761,1709,1901,2288,2072,2861,2411,2289,2203,2592,2053,1979,2048,1786,2876,2560)
n<-28
```

(a) Fit a multiple regression model relating the number of games won to the teams' passing yardage (x2), the percent rushing plays (x7), and the opponents' yards rushing (x8).
```{r}  
lm1<-lm(y~x2+x7+x8)
B0<-lm1$coef[[1]]
B1<-lm1$coef[[2]]
B2<-lm1$coef[[3]]
B3<-lm1$coef[[4]]
```

(b) Estimate $\sigma^2$.
```{r}
sig2<-summary(lm1)$sigma^2
sig2
```

(c) What are the standard errors of the regression coefficients?
```{r}
summary(lm1)
```
The error on the intercept is 7.8230190, x2 coefficient is 0.0006868, x7's is 0.0867682, and x8's is 0.0012723.

(d) Use the model to predict the number of games won when x2 = 2000 yards, x7 = 60%, and x8 = 1800.
```{r}
y_hat<-B0+(B1*2000)+(B2*60.0)+(B3*1800)
y_hat
```

(e) Test for significance of regression using $\alpha$ = 0.05. What is the P-value for this test?
```{r}
summary(lm1)
```
The p-value is 2.491e-08, much lower than 0.05, so we reject the hypothesis that all of the betas are null. 

(f) Conduct the t-test for each regression coefficient fi2, fi7, and fi8. Using $\alpha$ = 0.05, what conclusions can you draw about the variables in this model?
```{r}
alpha = 0.05
t_a<-qt(alpha/2,n-2,lower.tail=FALSE) #n-2 since test for each individual Beta
t_a
summary(lm1)
```
The absolute value for all of the p's are higher than t_a so we reject the hypotheses that any of them are 0.  

(g) Find the amount by which the regressor x8 (opponents'yards rushing) increases the regression sum of squares.
```{r}
lm2<-lm(y~x2+x7)
summary(lm2)
anova(lm2)
```
x8 sum of squares is 38.387, when added in this decreases the overall residuals from 106.668 to 68.281.

(h) Use the results from part (e) above and to conduct an F-test for H0 . fi8 = 0 versus H1 . fi8 <> 0 using $\alpha$ = 0.05. What is the P-value for this test? What conclusions can you draw?
```{r}
anova(lm1)
```
The pvalue is 0.001198, therefore we can reject the idea that x8's coefficient is 0. 

(i) Find a 95% confidence interval on fi8.
```{r}
alpha = 0.05
t_a<-qt(alpha/2,n-2,lower.tail=FALSE)
b<- -0.0046734
cil<-b-t_a*0.0012723
ciu<-b+t_a*0.0012723
```
The confidence interval for this is [`r cil`, `r ciu`]

(j) What is the estimated standard error of $\mu_hat_Y|x0$ when x2 = 2000 yards, x7 = 60%, and x8 = 1800 yards?
```{r}
sig2<-sigma(lm1)^2
x0<-c(2000,60,1800)
x_bar<-c(sum(x2)/n, sum(x7)/n, sum(x8)/n)
x<-sum(x0-x_bar)^2
sxx<-sum(x_bar^2)-(sum(x_bar)^2/n)
var<-sig2*(1+(1/n)+(x/sxx))
var
```


(k) Find a 95% confidence interval on the mean number of games won when x2 = 2000 yards, x7 = 60%, and x8 = 1800.
```{r}
alpha = 0.05
t_a<-qt(alpha/2,n-4,lower.tail=FALSE)
cil<-y_hat-t_a*var
ciu<-y_hat+t_a*var
```
The confidence interval for this is [`r cil`, `r ciu`]

